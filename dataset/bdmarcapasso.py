#!/usr/bin/python
import csv
from locale import atof, setlocale, LC_NUMERIC

# Função auxiliar para colocar um valor padrão aos campos não preenchidos
def int_with_default(value, default = 0):
    try:
        return int(value)
    except ValueError:
        return default

# Nome das colunas
labels = [
    #'record_id',
    'sex',
    #'dob',
    'age',
    'race',
    'education_level',
    'underlying_heart_disease',
    'heart_disease',
    'nyha_basal',
    'hypertension',
    'prior_mi',
    'heart_failure',
    'af',
    'cardiac_arrest',
    'transplant',
    'valvopathy',
    'endocardites',
    'diabetes',
    'renal_failure',
    'hemodialysis',
    'stroke',
    'copd',
    'cancer',
    'comorbidities_count',
    'surgery_count',
    #'date_procedure_1',
    #'year_procedure_1',
    #'age_surgery_1',
    #'procedure_type_1',
    #'reop_type_1',
    #'cied_final_1',
    #'death_intraop_1',
    #'date_procedure_2',
    #'year_procedure_2',
    #'age_surgery_2',
    #'reop_type_2',
    #'cied_final_2',
    #'death_intraop_2',
    #'date_procedure_3',
    #'year_procedure_3',
    #'age_surgery_3',
    #'reop_type_3',
    #'cied_final_3',
    #'death_intraop_3',
    #'date_procedure_4',
    #'year_procedure_4',
    #'age_surgery_4',
    #'reop_type_4',
    #'cied_final_4',
    #'death_intraop_4',
    #'date_procedure_5',
    #'year_procedure_5',
    #'age_surgery_5',
    #'reop_type_5',
    #'cied_final_5',
    #'death_intraop_5',
    #'date_procedure_6',
    #'year_procedure_6',
    #'age_surgery_6',
    #'reop_type_6',
    #'cied_final_6',
    # 'death_intraop_6',
    # 'date_procedure_7',
    #'year_procedure_7',
    #'age_surgery_7',
    #'reop_type_7',
    #'cied_final_7',
    #'death_intraop_7',
    #'date_procedure_8',
    #'year_procedure_8',
    #'age_surgery_8',
    #'reop_type_8',
    #'cied_final_8',
    #'death_intraop_8',
    #'date_procedure_9',
    #'year_procedure_9',
    #'age_surgery_9',
    #'reop_type_9',
    #'cied_final_9',
    #'death_intraop_9',
    #'date_procedure_10',
    #'year_procedure_10',
    #'age_surgery_10',
    #'reop_type_10',
    #'cied_final_10',
    #'death_intraop_10',
    #'time_p1p2',
    #'time_p2p3',
    #'time_p3p4',
    #'time_p4p5',
    #'time_p5p6',
    #'time_p6p7',
    #'time_p7p8',
    #'time_p8p9',
    #'time_p9p10',
    #'upgrade_p1p2',
    #'upgrade_p2p3',
    #'upgrade_p3p4',
    #'upgrade_p4p5',
    #'upgrade_p5p6',
    #'upgrade_p6p7',
    #'upgrade_p7p8',
    #'upgrade_p8p9',
    #'upgrade_p9p10',
    'upgrade_count',
    #'readmission_count',
    'dialysis_hosp',
    'icu_hosp',
    #'admission_t0',
    #'admission_posop_count',
    'admission_pre_t0_count',
    'admission_pre_t0_180d',
    'year_adm_t0',
    #'date_admission_t0',
    #'date_discharge_t0',
    'icu_t0',
    'dialysis_t0', # Pq vazio
    #'disch_outcomes_t0',
    'dialysis_post_t0',
    #'icu_post_t0',
    #'readmission_30d',
    #'readmission_60d',
    #'readmission_180d',
    #'readmission_1year',
    #'final_outcome',
    #'date_last_visit',
    #'survival_time_overall',
    #'death_intraop',
    #'death_hospitalar',
    #'death_readmission',
    #'death_30days',
    #'death_180days',
    #'death_1year',
    #'death_2year',
    #'death_3year',
    #'death',
    #'date_death',
    #'survival_time_death',
    #'death_cause',
    'admission_t0_emergency',
    'aco',
    'antiarritmico',
    'antihipertensivo',
    'betabloqueador',
    'ieca_bra',
    'dva',
    'digoxina',
    'estatina',
    'diuretico',
    'vasodilatador',
    'insuf_cardiaca',
    'espironolactona',
    'bloq_calcio',
    'trombolitico',
    'antiplaquetario_vo',
    'antiplaquetario_ev',
    'insulina',
    'hipoglicemiante',
    'hormonio_tireoidiano',
    'broncodilatador',
    'anticonvulsivante',
    'psicofarmacos',
    'atb',
    'antifungico',
    'antiviral',
    'antiretroviral',
    #'classe_meds_qtde',
    'vni',
    'ventilacao_mecanica',
    'cec',
    'cir_cardiovascular',
    'transplante_cardiaco',
    'cir_toracica',
    'outros_proced_cirurgicos',
    'traqueostomia',
    'icp',
    'intervencao_cv',
    'stent',
    'angioplastia',
    'cateterismo',
    'eletrofisiologia',
    'suporte_hemod',
    'cateter_venoso_central',
    'drenagem_torax',
    #'proced_invasivos_qtde',
    #'cve_desf',
    #'transfusao',
    #'interconsulta',
    #'equipe_multiprof',
    #'ecg',
    #'holter',
    #'teste_esforco',
    #'espiro_ergoespiro',
    #'tilt_teste',
    #'polissonografia',
    'metodos_graficos_qtde',
    #'laboratorio',
    #'cultura',
    'analises_clinicas_qtde',
    #'citologia',
    #'biopsia',
    'histopatologia_qtde',
    'angio_rm',
    'angio_tc',
    'angiografia',
    'aortografia',
    'arteriografia',
    'cavografia',
    'cintilografia',
    'ecocardiograma',
    'endoscopia',
    'flebografia',
    'pet_ct',
    'ultrassom',
    'tomografia',
    'radiografia',
    'ressonancia',
    #'exames_imagem_qtde',
    'dieta_enteral',
    'dieta_parenteral',
    'bic',
    'mpp',
]

# Carrega o arquivo
def load_data(database = '../BDMarcapasso_09jun22.csv'):
    result = {"X": [],
        "y_readmission30d": [],
        "y_readmission60d": [],
        "y_readmission180d": [],
        "y_readmission1y": [],
        "y_death_intraop": [],
        "y_death_hospitalar": [],
        "y_death_readmission": [],
        "y_death30d": [],
        "y_death180d": [],
        "y_death1y": [],
        "y_death2y": [],
        "y_death3y": [],
    }
    with open(database, newline='') as csvfile:
        reader = csv.DictReader(csvfile)
        for row in reader:
            result["X"].append(prepare_sample(row))
            result["y_readmission30d"].append(row['readmission_30d'])
            result["y_readmission60d"].append(row['readmission_60d'])
            result["y_readmission180d"].append(row['readmission_180d'])
            result["y_readmission1y"].append(row['readmission_1year'])
            result["y_death_intraop"].append(row['death_intraop'])
            result["y_death_hospitalar"].append(row['death_hospitalar'])
            result["y_death_readmission"].append(row['death_readmission'])
            result["y_death30d"].append(row['death_30days'])
            result["y_death180d"].append(row['death_180days'])
            result["y_death1y"].append(row['death_1year'])
            result["y_death2y"].append(row['death_2year'])
            result["y_death3y"].append(row['death_3year'])
    return result

# Tratamos os vários campos
def prepare_sample(sample):
    setlocale(LC_NUMERIC, 'pt_BR.UTF-8')
    result = [
        #int(sample['record_id']),
        int(sample['sex']),
        #int(sample['dob']),
        atof(sample['age']),
        int_with_default(sample['race'],0),
        int_with_default(sample['education_level'], 0),
        int_with_default(sample['underlying_heart_disease'],0),
        int_with_default(sample['heart_disease'],0),
        int_with_default(sample['nyha_basal'],0),
        int_with_default(sample['hypertension'],0),
        int_with_default(sample['prior_mi'],0),
        int_with_default(sample['heart_failure'],0),
        int_with_default(sample['af'],0),
        int_with_default(sample['cardiac_arrest'],0),
        int_with_default(sample['transplant'],0),
        int_with_default(sample['valvopathy'],0),
        int_with_default(sample['endocardites'],0),
        int_with_default(sample['diabetes'],0),
        int_with_default(sample['renal_failure'],0),
        int_with_default(sample['hemodialysis'],0),
        int_with_default(sample['stroke'],0),
        int_with_default(sample['copd'],0),
        int_with_default(sample['cancer']),
        int_with_default(sample['comorbidities_count']),
        int(sample['surgery_count']),
        #sample['date_procedure_1'],
        #int(sample['year_procedure_1']),
        #atof(sample['age_surgery_1']),
        #int(sample['procedure_type_1']),
        #int_with_default(sample['reop_type_1']),
        #int(sample['cied_final_1']),
        #sample['death_intraop_1'],
        #sample['date_procedure_2'],
        #int_with_default(sample['year_procedure_2'],1990), # Coloquei 1990 como valor padrão para, numa normalização entre [0,1], não ficar muito afastado. Reconsiderar
        #atof(sample['age_surgery_2']) if (sample['age_surgery_2'] != '') else 0,
        #int_with_default(sample['reop_type_2']),
        #int_with_default(sample['cied_final_2']),
        #sample['death_intraop_2'],
        #sample['date_procedure_3'],
        #int_with_default(sample['year_procedure_3'],1990),
        #atof(sample['age_surgery_3']) if (sample['age_surgery_3'] != '') else 0,
        #int_with_default(sample['reop_type_3']),
        #int_with_default(sample['cied_final_3']),
        #sample['death_intraop_3'],
        #sample['date_procedure_4'],
        #int_with_default(sample['year_procedure_4'],1990),
        #atof(sample['age_surgery_4']) if (sample['age_surgery_4'] != '') else 0,
        #int_with_default(sample['reop_type_4']),
        #int_with_default(sample['cied_final_4']),
        #sample['death_intraop_4'],
        #sample['date_procedure_5'],
        #int_with_default(sample['year_procedure_5'],1990),
        #atof(sample['age_surgery_5']) if (sample['age_surgery_5'] != '') else 0,
        #int_with_default(sample['reop_type_5']),
        #int_with_default(sample['cied_final_5']),
        #sample['death_intraop_5'],
        #sample['date_procedure_6'],
        #int_with_default(sample['year_procedure_6'],1990),
        #atof(sample['age_surgery_6']) if (sample['age_surgery_6'] != '') else 0,
        #int_with_default(sample['reop_type_6']),
        #int_with_default(sample['cied_final_6']),
        # sample['death_intraop_6'],
        # sample['date_procedure_7'],
        #int_with_default(sample['year_procedure_7'],1990),
        #atof(sample['age_surgery_7']) if (sample['age_surgery_7'] != '') else 0,
        #int_with_default(sample['reop_type_7']),
        #int_with_default(sample['cied_final_7']),
        #sample['death_intraop_7'],
        #sample['date_procedure_8'],
        #int_with_default(sample['year_procedure_8'],1990),
        #atof(sample['age_surgery_8']) if (sample['age_surgery_8'] != '') else 0,
        #int_with_default(sample['reop_type_8']),
        #int_with_default(sample['cied_final_8']),
        #sample['death_intraop_8'],
        #sample['date_procedure_9'],
        #int_with_default(sample['year_procedure_9'],1990),
        #atof(sample['age_surgery_9']) if (sample['age_surgery_9'] != '') else 0,
        #int_with_default(sample['reop_type_9']),
        #int_with_default(sample['cied_final_9']),
        #sample['death_intraop_9'],
        #sample['date_procedure_10'],
        #int_with_default(sample['year_procedure_10'],1990),
        #atof(sample['age_surgery_10']) if (sample['age_surgery_10'] != '') else 0,
        #int_with_default(sample['reop_type_10']),
        #int_with_default(sample['cied_final_10']),
        #sample['death_intraop_10'],
        #atof(sample['time_p1p2']) if (sample['time_p1p2'] != '') else 300, # Mesma coisa que o ano
        #atof(sample['time_p2p3']) if (sample['time_p2p3'] != '') else 300,
        #atof(sample['time_p3p4']) if (sample['time_p3p4'] != '') else 300,
        #atof(sample['time_p4p5']) if (sample['time_p4p5'] != '') else 300,
        #atof(sample['time_p5p6']) if (sample['time_p5p6'] != '') else 300,
        #atof(sample['time_p6p7']) if (sample['time_p6p7'] != '') else 300,
        #atof(sample['time_p7p8']) if (sample['time_p7p8'] != '') else 300,
        #atof(sample['time_p8p9']) if (sample['time_p8p9'] != '') else 300,
        #atof(sample['time_p9p10']) if (sample['time_p9p10'] != '') else 300,
        #sample['upgrade_p1p2'],
        #sample['upgrade_p2p3'],
        #sample['upgrade_p3p4'],
        #sample['upgrade_p4p5'],
        #sample['upgrade_p5p6'],
        #sample['upgrade_p6p7'],
        #sample['upgrade_p7p8'],
        #sample['upgrade_p8p9'],
        #sample['upgrade_p9p10'],
        int_with_default(sample['upgrade_count']),
        #int(sample['readmission_count']),
        int_with_default(sample['dialysis_hosp']),
        int_with_default(sample['icu_hosp']),
        #sample['admission_t0'],
        #int_with_default(sample['admission_posop_count']),
        int_with_default(sample['admission_pre_t0_count']),
        int_with_default(sample['admission_pre_t0_180d']),
        int_with_default(sample['year_adm_t0'],1990),
        #sample['date_admission_t0'],
        #sample['date_discharge_t0'],
        atof(sample['icu_t0']) if (sample['icu_t0'] != '') else 0,
        int_with_default(sample['dialysis_t0']), # Pq vazio
        #sample['disch_outcomes_t0'],
        int(sample['dialysis_post_t0']),
        #int(sample['icu_post_t0']),
        #sample['readmission_30d'],
        #sample['readmission_60d'],
        #sample['readmission_180d'],
        #sample['readmission_1year'],
        #sample['final_outcome'],
        #sample['date_last_visit'],
        #sample['survival_time_overall'],
        #sample['death_intraop'],
        #sample['death_hospitalar'],
        #sample['death_readmission'],
        #sample['death_30days'],
        #sample['death_180days'],
        #sample['death_1year'],
        #sample['death_2year'],
        #sample['death_3year'],
        #sample['death'],
        #sample['date_death'],
        #sample['survival_time_death'],
        #sample['death_cause'],
        int_with_default(sample['admission_t0_emergency']),
        int_with_default(sample['aco']),
        int_with_default(sample['antiarritmico']),
        int_with_default(sample['antihipertensivo']),
        int_with_default(sample['betabloqueador']),
        int_with_default(sample['ieca_bra']),
        int_with_default(sample['dva']),
        int_with_default(sample['digoxina']),
        int_with_default(sample['estatina']),
        int_with_default(sample['diuretico']),
        int_with_default(sample['vasodilatador']),
        int_with_default(sample['insuf_cardiaca']),
        int_with_default(sample['espironolactona']),
        int_with_default(sample['bloq_calcio']),
        int_with_default(sample['trombolitico']),
        int_with_default(sample['antiplaquetario_vo']),
        int_with_default(sample['antiplaquetario_ev']),
        int_with_default(sample['insulina']),
        int_with_default(sample['hipoglicemiante']),
        int_with_default(sample['hormonio_tireoidiano']),
        int_with_default(sample['broncodilatador']),
        int_with_default(sample['anticonvulsivante']),
        int_with_default(sample['psicofarmacos']),
        int_with_default(sample['atb']),
        int_with_default(sample['antifungico']),
        int_with_default(sample['antiviral']),
        int_with_default(sample['antiretroviral']),
        #int_with_default(sample['classe_meds_qtde']),
        int_with_default(sample['vni']),
        int_with_default(sample['ventilacao_mecanica']),
        int_with_default(sample['cec']),
        int_with_default(sample['cir_cardiovascular']),
        int_with_default(sample['transplante_cardiaco']),
        int_with_default(sample['cir_toracica']),
        int_with_default(sample['outros_proced_cirurgicos']),
        int_with_default(sample['traqueostomia']),
        int_with_default(sample['icp']),
        int_with_default(sample['intervencao_cv']),
        int_with_default(sample['stent']),
        int_with_default(sample['angioplastia']),
        int_with_default(sample['cateterismo']),
        int_with_default(sample['eletrofisiologia']),
        int_with_default(sample['suporte_hemod']),
        int_with_default(sample['cateter_venoso_central']),
        int_with_default(sample['drenagem_torax']),
        #int_with_default(sample['proced_invasivos_qtde']),
        #int_with_default(sample['cve_desf']),
        #int_with_default(sample['transfusao']),
        #int_with_default(sample['interconsulta']),
        #int_with_default(sample['equipe_multiprof']),
        #int_with_default(sample['ecg']),
        #int_with_default(sample['holter']),
        #int_with_default(sample['teste_esforco']),
        #int_with_default(sample['espiro_ergoespiro']),
        #int_with_default(sample['tilt_teste']),
        #int_with_default(sample['polissonografia']),
        int_with_default(sample['metodos_graficos_qtde']),
        #int_with_default(sample['laboratorio']),
        #int_with_default(sample['cultura']),
        int_with_default(sample['analises_clinicas_qtde']),
        #int_with_default(sample['citologia']),
        #int_with_default(sample['biopsia']),
        int_with_default(sample['histopatologia_qtde']),
        int_with_default(sample['angio_rm']),
        int_with_default(sample['angio_tc']),
        int_with_default(sample['angiografia']),
        int_with_default(sample['aortografia']),
        int_with_default(sample['arteriografia']),
        int_with_default(sample['cavografia']),
        int_with_default(sample['cintilografia']),
        int_with_default(sample['ecocardiograma']),
        int_with_default(sample['endoscopia']),
        int_with_default(sample['flebografia']),
        int_with_default(sample['pet_ct']),
        int_with_default(sample['ultrassom']),
        int_with_default(sample['tomografia']),
        int_with_default(sample['radiografia']),
        int_with_default(sample['ressonancia']),
        #int_with_default(sample['exames_imagem_qtde']),
        int_with_default(sample['dieta_enteral']),
        int_with_default(sample['dieta_parenteral']),
        int_with_default(sample['bic']),
        int_with_default(sample['mpp']),

    ]
    return result
